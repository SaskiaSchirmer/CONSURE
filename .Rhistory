tmp
tmp <- table(tab$markArea, factor(tab$ageInDays, levels = 1:16526))
tmp
tmp <- as.data.frame.matrix(table(tab$markArea, factor(tab$ageInDays, levels = 1:16526)))
View(tmp)
marked
marked %>% group_by(markArea) %>%
summarise(numberMarked = n())
marked %>% group_by(markArea) %>%
summarise(numberMarked = sum(numberMarked))
tmp2 <- marked %>% group_by(markArea) %>%
summarise(numberMarked = sum(numberMarked))
merge(tmp,tmp2, by.x = rownames(tmp), by.y = markArea)
tmp$markArea <- row.names(tmp)
merge(tmp, tmp2, by = markArea)
tmp$markArea
merge(tmp, tmp2, by = markArea)
tmp <- as.data.frame.matrix(table(tab$markArea, factor(tab$ageInDays, levels = 1:16526)))
tmp$markArea <- row.names(tmp)
marked <- readr::read_delim("/home/saskia/Dokumente/DokumenteBuero/WiAssSempach/projects/osprey/data/markedPerYear.txt", delim = " ")
tmp2 <- marked %>% group_by(markArea) %>%
summarise(numberMarked = sum(numberMarked))
merge(tmp, tmp2, by = markArea)
tmp
tmp$markArea
tmp2$markArea
merge(tmp, tmp2, by = "markArea")
tmp3 <- merge(tmp, tmp2, by = "markArea", all = FALSE)
View(tmp3)
tmp3$numberMarked <- tmp3$numberMarked - rowSums(tmp3[,2:16527])
View(tmp3)
marr <- tmp3[,2:16528]
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s
r[t] <- mean.r
}
mean.s ~ dunif(0, 1)              # Prior for mean survival
mean.r ~ dunif(0, 1)              # Prior for mean recovery
# Define the multinomial likelihood
for (t in 1:n.occasions){
marr[t,1:(n.occasions+1)] ~ dmulti(pr[t,], rel[t])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (t in 1:n.occasions){
pr[t,t] <- (1-s[t])*r[t]
# Above main diagonal
for (j in (t+1):n.occasions){
pr[t,j] <- prod(s[t:(j-1)])*(1-s[j])*r[j]
} #j
# Below main diagonal
for (j in 1:(t-1)){
pr[t,j] <- 0
} #j
} #t
# Last column: probability of non-recovery
for (t in 1:n.occasions){
pr[t,n.occasions+1] <- 1-sum(pr[t,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr))
# Initial values
inits <- function(){list(mean.s = runif(1, 0, 1), mean.r = runif(1, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
jags.data$n.occasions
View(marr)
marr <- tmp3[,2:50]
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s
r[t] <- mean.r
}
mean.s ~ dunif(0, 1)              # Prior for mean survival
mean.r ~ dunif(0, 1)              # Prior for mean recovery
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(1, 0, 1), mean.r = runif(1, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(1, 0, 1), mean.r = runif(1, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
hist(mr$BUGSoutput$sims.list$mean.s, nclass = 25, col = "gray", main = "", ylab = "Frequency", xlab = "Survival probability")
mr$BUGSoutput$sims.list$mean.s
boxplot(mr$BUGSoutput$sims.list$mean.s)
boxplot(mr$BUGSoutput$sims.list$mean.r)
marr <- tmp3[,2:150]
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
boxplot(mr$BUGSoutput$sims.list$mean.s)
boxplot(mr$BUGSoutput$sims.list$mean.r)
marr <- tmp3[,2:50]
marr[,(ncol(marr)+1)] <- tmp3$numberMarked + rowSums(tmp3[,151:16527])
marr
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
boxplot(mr$BUGSoutput$sims.list$mean.s)
boxplot(mr$BUGSoutput$sims.list$mean.r)
marr <- tmp3[,2:150]
marr[,(ncol(marr)+1)] <- tmp3$numberMarked + rowSums(tmp3[,151:16527])
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags",
n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
boxplot(mr$BUGSoutput$sims.list$mean.s)
boxplot(mr$BUGSoutput$sims.list$mean.r)
cut(tab$ageInDays, seq(1,16540,by = 20))
tmp <- as.data.frame.matrix(table(tab$markArea, cut(tab$ageInDays, seq(1,16540,by = 20))))
tmp$markArea <- row.names(tmp)
tmp
marked <- readr::read_delim("/home/saskia/Dokumente/DokumenteBuero/WiAssSempach/projects/osprey/data/markedPerYear.txt", delim = " ")
tmp2 <- marked %>% group_by(markArea) %>%
summarise(numberMarked = sum(numberMarked))
tmp3 <- merge(tmp, tmp2, by = "markArea", all = FALSE)
tmp3$numberMarked <- tmp3$numberMarked - rowSums(tmp3[,2:16527])
tmp3$numberMarked <- tmp3$numberMarked - rowSums(tmp3[,2:(ncol(tmp3)-1)])
marr <- tmp3[,2:50]
marr[,(ncol(marr)+1)] <- tmp3$numberMarked + rowSums(tmp3[,151:(ncol(tmp3)-1)])
age <- c(rep(1,365), rep(2, 365), rep(3, ncol(marr)-1-2*365))
doy <- rep(rep(1,365), 30)[1:length(age)]
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags",
n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
boxplot(mr$BUGSoutput$sims.list$mean.s)
boxplot(mr$BUGSoutput$sims.list$mean.r)
marr <- tmp3[,2:150]
marr[,(ncol(marr)+1)] <- tmp3$numberMarked + rowSums(tmp3[,151:(ncol(tmp3)-1)])
age <- c(rep(1,365), rep(2, 365), rep(3, ncol(marr)-1-2*365))
doy <- rep(rep(1,365), 30)[1:length(age)]
library(lubridate)
f <- yday(tab$markingDate)
year <- year(tab$markingDate)
sink("mr-mnl.jags")
cat("
model {
# Priors and constraints
for (t in 1:n.occasions){
s[t] <- mean.s[t]
r[t] <- mean.r[t]
}
for(t in 1:n.occasions){
mean.s[t] ~ dunif(0, 1)              # Prior for mean survival
mean.r[t] ~ dunif(0, 1)              # Prior for mean recovery
}
# Define the multinomial likelihood
for (b in 1:B){
marr[b,1:(n.occasions+1)] ~ dmulti(pr[b,], rel[b])
}
# Define the cell probabilities of the m-array
# Main diagonal
for (b in 1:B){
pr[b,1] <- (1-s[1])*r[1]
# Above main diagonal
for (j in 2:n.occasions){
pr[b,j] <- prod(s[1:(j-1)])*(1-s[j])*r[j]
} #j
}
# Last column: probability of non-recovery
for (b in 1:B){
pr[b,n.occasions+1] <- 1-sum(pr[b,1:n.occasions])
} #t
}
",fill = TRUE)
sink()
# Bundle data
jags.data <- list(marr = marr, n.occasions = dim(marr)[2]-1, rel = rowSums(marr),
B = dim(marr)[1])
# Initial values
inits <- function(){list(mean.s = runif(n.occasions, 0, 1), mean.r = runif(n.occasions, 0, 1))}
# Parameters monitored
parameters <- c("mean.s", "mean.r")
# MCMC settings
ni <- 5000
nt <- 6
nb <- 2000
nc <- 3
# Call JAGS from R (BRT <1 min)
mr <- jags(jags.data, inits=NULL, parameters, "mr-mnl.jags",
n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb, working.directory = getwd())
# Summarize posteriors
print(mr, digits = 3)
boxplot(mr$BUGSoutput$sims.list$mean.s)
365/20
boxplot(mr$BUGSoutput$sims.list$mean.r)
150/20
load("~/Dokumente/DokumenteBuero/WiAssSempach/RCode/CONSUREcontinuousOnly/mro2_paper.Rdata")
library(CONSURE)
split <- c(rep(rep(1:2, each = 50),50),rep(rep(3:4, each = 50),50))
knots_prop <-list(latitude = seq(0,100222.8,le=3),
longitude = seq(0,123642.5,le=3))
mro2 <- calc_discrete_m(mro2,knots_prop)
mro2 <- calc_discrete_m(mro2,knots_prop)
o_o <- optimization_object(mark_recapture_object = mro2,
y = list(longitude = seq(0,100222.8,le = 100),
latitude = seq(0,123642.5,le=100)),
knots = list(longitude = seq(0,100222.8,le=10),
latitude = seq(0,123642.5,le=10)),
b = "all",
split = split,
lambda = c(.001,10),use_corrected_m = FALSE
)
tmp <- comb_estimate(optimization_object = o_o, maxit = 100000000,start_times =1,reltol = 1e-8, change_r = TRUE)
tmp <- comb_estimate(optimization_object = o_o, maxit = 100000000,start_times =10,reltol = 1e-8, change_r = TRUE)
tmp <- comb_estimate(optimization_object = o_o, maxit = 100000000,start_times =10,reltol = 1e-8, change_r = TRUE)
