---
title: "Simulation and estimation with the continuous approach in one-dimensional space"
author: Saskia Schirmer
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SimulationAndEstimationContinuousApproach1D}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(CONSURE)
```



## Estimating the parameters

CONSURE can estimate the three parameters survival, migratory connectivity and recovery probability. Therefore, we load simulated data as shown in the [vignette on simulating data](SimulatingData.html).

```{r}
data("mro1D")
```

The parameters are estimated in every point. Theoretically, it would be possible to estimate a value for every point in space. Practically, we estimate values on a point grid, with a resolution high enough that we can visualize it as a continuous estimate, but small enough that computation time is short and storage small. To obtain a coarse overview we set the reslution to 100:

```{r}
res <- 100
```

We use two subsets of the data. The first is the dead recoveries aggregated over all breeding areas. The raw data points facetted by age and area look like the following:
```{r fig.fullwidth=TRUE, fig.width=7, fig.height=5}
#plotRawRecoveries(mro1D, facetByAge = TRUE)
```

The second dataset contains the dead recoveries for each separate breeding area:
```{r fig.fullwidth=TRUE, fig.width=7, fig.height=5}
 plotRawRecoveries(mro1D, facetByAge = TRUE, facetByArea = TRUE)
```




From these data points we estimate the kernel density. We need to do this twice. One time for the aggregated dataset over all breeding areas and one time for each breeding area separately. The result needs can be stored under the same name as the initialized markRecaptureObject:
```{r}
mro1D <- estKDE(mro1D,res, all = TRUE)
```

```{r fig.fullwidth=TRUE, fig.width=7, fig.height=5}
plotKDE("all", mro1D,trueValuesAvailable = TRUE)
```

```{r}
mro1D <- estKDE(mro1D,res)
```

```{r fig.fullwidth=TRUE, fig.width=20, fig.height=10}
plotKDE("b1", mro1D,trueValuesAvailable = TRUE)
```



Now, we estimate survival:
```{r warning=FALSE}
mro1D <- estS(res,markRecaptureObject = mro1D)
```

The robust estimation of the linear model often throws warnings when the algorithm does not converge.

```{r warning=FALSE}
mro1D <- estM(res, markRecaptureObject =  mro1D)
mro1D <- estM(res,markRecaptureObject = mro1D, all  = TRUE)
```

```{r eval=FALSE}
mro1D <- estR(mro1D)
```
