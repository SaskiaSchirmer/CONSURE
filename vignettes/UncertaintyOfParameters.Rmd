---
title: "Uncertainty of parameters"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Uncertainty of parameters}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(CONSURE)
```

In this vignette, we want to show how to get bootstrap quantiles for estimated parameters.

Firstly, we simulate a data set in one-dimensional space and estimate all parameters:

```{r}
B <- 3    # number of breeding areas
mro <- markRecaptureObject(xrange = c(0,1),
                    survival = function(w){stmp <- function(w){0.5*w+.4}
                    stmp(w/100222.8)
                    },
                    recovery = function(w){0.1},
                    migratoryConnectivity =function(b,w,B=B){ mtmp <- function(b,w,B=B){
                      truncnorm::dtruncnorm(w,0,1, 
                                            mean = seq(0.1,0.9,length.out = B)[b], 
                                            sd = 0.3)}
                    mtmp(b,w/100222.8,B)},
                    markedInds = rep(1000,B),
                    observationTime = 10, robust = TRUE)
mro <- simContin(mro)

mro <- estParameters(mro, res = 100)
```

Now, we want to specifiy how uncertain we are about these parameter estimates. Therefore, we bootstrap the existing data. Bootstrapping means, we create a new data set by sampling as many data points as the existing ones from the existing ones with replacement. We do this many times (often 999 times). As this is a quite large list of data sets and estimating the parameters is independent between the data sets, we can estimate the parameters for smaller subsets of the list of bootstrapped data. This is only necessary, when estimating the parameter takes very long (see the two-dimensional example, how to deal with this situation). In one-dimensional space computation time is not so long, so we decide to do all iterations at once. In every case, the sampling process for all bootstrapped data sets must be done at once for technical reasons. Therefore, we initialize a list of bootstrapped data sets using the CONSURE-function initializeBootstrappedDatasets. We choose only 100 iterations to take the duration short. The file will be saved in your current working directory, unless you specify the whole path. The file extension .Rdata will be added automatically:

```{r}
bdata <- initializeBootstrappedDatasets(iterations = 3, markRecaptureObject = mro, filename = "test")
```

Now, we estimate the parameters for every bootstrapped data set by forwarding the list of bootstrapped data by the initializeBootstrappedDatasets-function to the estUncertainty-function:
```{r message = FALSE, warning = FALSE}
mro <- estUncertainty(mro, bootstrapData = bdata, filename = "test")
```

Finally, we estimate the 2.5%- and 97.5%-Quantiles of the estimates of the bootstrapped data sets, so we can plot the uncertainty:
```{r message=FALSE}
mro <- bootstrapQuantiles(markRecaptureObject = mro, filename = "test", param = c("s","m","r","gof"))
```

The bootstrap interval will be automatically plotted. Nevertheless, it can be suppressed by setting the argument noCI to TRUE.

```{r}
 plotS(mro, trueValuesAvailable = TRUE)
 plotGOFofLM(mro)
 plotM(mro, trueValuesAvailable = TRUE)
```




